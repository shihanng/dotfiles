---
- name: Check if plugin is installed
  ansible.builtin.shell: |
    source {{ ansible_env.HOME }}/.asdf/asdf.sh

    asdf plugin-list | grep {{ plugin }}
  args:
    executable: zsh
  register: plugin_check_result
  changed_when: false
  ignore_errors: true

- name: Install plugin
  ansible.builtin.shell: |
    source {{ ansible_env.HOME }}/.asdf/asdf.sh

    asdf plugin-add {{ plugin }} {{ repo }}
  args:
    executable: zsh
  when: plugin_check_result.rc == 1

- name: Check if a version is installed
  ansible.builtin.shell: |
    source {{ ansible_env.HOME }}/.asdf/asdf.sh

    asdf list {{ plugin }} {{ version }}
  args:
    executable: zsh
  changed_when: false
  ignore_errors: true
  register: check_install

- name: Install version
  ansible.builtin.shell: |
    source {{ ansible_env.HOME }}/.asdf/asdf.sh

    asdf install {{ plugin }} {{ version }}
  args:
    executable: zsh
  when: check_install.rc == 1
