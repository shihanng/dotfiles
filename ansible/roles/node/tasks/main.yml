---
- name: Create nvm directory
  file:
    path: ~/.nvm
    state: directory
  become_user: "{{ ansible_user_id }}"

- name: Install nvm
  shell: >
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash
  args:
    creates: "{{ ansible_env.HOME }}/.nvm/nvm.sh"

- name: Install node and set version
  shell: /bin/bash -c "source ~/.nvm/nvm.sh && nvm install v10.16.0 && nvm alias default v10.16.0"
  args:
    creates: $HOME/.nvm/alias

- name: Install yarn
  shell: source ~/.nvm/nvm.sh && curl -o- -L https://yarnpkg.com/install.sh | bash
  args:
    creates: $HOME/.yarn
